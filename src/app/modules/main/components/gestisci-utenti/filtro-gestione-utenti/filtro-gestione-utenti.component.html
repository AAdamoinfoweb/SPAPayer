<!-- Sottotitolo -->
<div class="row subsection-title">
  <div class="col-xs-5 pt-4">
    <p class="title page-subtitle">Filtri</p>
  </div>
  <div class="col-xs-4 mb-2">
    <svg id="img-arrow" class="bg-light icon"
         data-toggle="collapse" data-target="#contenutoSezioneFiltri"
         aria-expanded="true" aria-controls="contenutoSezioneFiltri"
         (click)="setArrowType()">
      <use [attr.xlink:href]="arrowType" xlink:href=""></use>
    </svg>
  </div>
</div>

<!-- Form filtri -->
<form #filtroGestioneUtentiForm="ngForm" (ngSubmit)="filtroGestioneUtentiForm">
  <div id="contenutoSezioneFiltri" class="collapse show">
    <!-- Livello Territoriale, Società, Ente -->
    <div class="row section-row mt-2 mb-0">
      <div class="col-md-4 pb-2">
        <div class="row">
          <label for="selectSocieta" class="title">Società</label>
        </div>
        <div class="row">
          <select class="form-elem" id="selectSocieta" name="societaId"
                  [(ngModel)]="filtroGestioneUtentiApplicato.societaId" (ngModelChange)="selezionaSocieta()">
            <option *ngFor="let item of listaSocieta" [value]="item.value">{{item.label}}</option>
          </select>
        </div>
        <div class="row">
          <small class="form-text text-muted">seleziona un elemento dalla lista</small>
        </div>
      </div>
      <div class="col-md-4 pb-2">
        <div class="row">
          <label for="selectLivelloTerritoriale" class="title">Livello Territoriale</label>
        </div>
        <div class="row">
          <select class="form-elem" id="selectLivelloTerritoriale" name="livelloTerritorialeId"
                  [(ngModel)]="filtroGestioneUtentiApplicato.livelloTerritorialeId" (ngModelChange)="selezionaLivelloTerritoriale()">
            <option *ngFor="let item of listaLivelliTerritoriali" [value]="item.value">{{item.label}}</option>
          </select>
        </div>
        <div class="row">
          <small class="form-text text-muted">seleziona un elemento dalla lista</small>
        </div>
      </div>
      <div class="col-md-4">
        <div class="row">
          <label for="selectEnte" class="title">Ente</label>
        </div>
        <div class="row">
          <select class="form-elem" id="selectEnte" name="enteId"
                  [disabled]="filtroGestioneUtentiApplicato.livelloTerritorialeId == null || !listaEnti.length"
                  [(ngModel)]="filtroGestioneUtentiApplicato.enteId" (ngModelChange)="selezionaEnte()">
            <option *ngFor="let item of listaEnti" [value]="item.value">{{item.label}}</option>
          </select>
        </div>
        <div class="row">
          <small class="form-text text-muted">seleziona un elemento dalla lista</small>
        </div>
      </div>
    </div>

    <!-- Servizio, Funzione abilitata, User ID (cod. fiscale) -->
    <div class="row section-row mb-0">
      <div class="col-md-4 pb-2">
        <div class="row">
          <label for="selectServizio" class="title">Servizio</label>
        </div>
        <div class="row">
          <select class="form-elem" id="selectServizio" name="servizioId"
                  [disabled]="filtroGestioneUtentiApplicato.enteId == null || !listaServizi.length"
                  [(ngModel)]="filtroGestioneUtentiApplicato.servizioId" (ngModelChange)="selezionaServizio()">
            <option *ngFor="let item of listaServizi" [value]="item.value">{{item.label}}</option>
          </select>
        </div>
        <div class="row">
          <small class="form-text text-muted">seleziona un elemento dalla lista</small>
        </div>
      </div>
      <div class="col-md-4 pb-2">
        <div class="row">
          <label for="selectFunzioneAbilitata" class="title">Funzione abilitata</label>
        </div>
        <div class="row">
          <select class="form-elem" id="selectFunzioneAbilitata" name="funzioneId"
                  [(ngModel)]="filtroGestioneUtentiApplicato.funzioneId" (ngModelChange)="selezionaFunzione()">
            <option *ngFor="let item of listaFunzioniAbilitate" [value]="item.value">{{item.label}}</option>
          </select>
        </div>
        <div class="row">
          <small class="form-text text-muted">seleziona un elemento dalla lista</small>
        </div>
      </div>
      <div class="col-md-4">
        <div class="row">
          <label for="inputUserId" class="title">User ID (cod. fiscale)</label>
        </div>
        <div class="row">
          <input type="text" class="input-text form-elem pt-0" name="codiceFiscale"
                 id="inputUserId" aria-describedby="inputUserIdHelpDescription"
                 autocomplete="off" maxlength="16"
                 pattern="^[A-Za-z]{6}[0-9]{2}[A-Za-z]{1}[0-9]{2}[A-Za-z]{1}[0-9]{3}[A-Za-z]{1}$"
                 #codicefiscaleinput = "ngModel"
                 [(ngModel)]="filtroGestioneUtentiApplicato.codiceFiscale"
                 (ngModelChange)="setPlaceholderCodiceFiscaleField(codicefiscaleinput)">
        </div>
        <div class="row">
          <small id="inputUserIdHelpDescription" class="form-text text-muted">{{placeholderCf}}</small>
        </div>
      </div>
    </div>

    <!-- Scadenza abilitazione Da - a, Ultimo accesso da - a -->
    <div class="row section-row mt-3 mb-0">
      <div class="col-lg-2 col-md-3 col-sm-4 pb-2">
        <div class="row">
          <label for="scadenzaDataDa" class="title">Scadenza abilit. - Da</label>
        </div>
        <div class="row">
          <svg class="bg-light icon img-calendar" (click)="openDatepicker(datePickerScadenzaDa)">
            <use xlink:href="assets/img/sprite.svg#it-calendar"></use>
          </svg>
          <dp-date-picker
            mode="day"
            id="scadenzaDataDa"
            theme="dp-material"
            [config]="{
              locale: 'it',
              format: 'DD/MM/YYYY',
              firstDayOfWeek: 'mo',
              showGoToCurrent: false,
              openOnClick: isCalendarOpen,
              openOnFocus: false,
              min: minDateDDMMYY
	          }"
            #scadenzaDaInput = "ngModel"
            [(ngModel)]="filtroGestioneUtentiApplicato.dataScadenzaDa"
            name="dataScadenzaDa"
            [minDate]="minDateDDMMYY"
            date
            #datePickerScadenzaDa
            (click)="isCalendarOpen = false"
            (onSelect)="selezionaData(datePickerScadenzaDa, 'dataScadenzaDa')"
            (onChange)="selezionaData(datePickerScadenzaDa, 'dataScadenzaDa')"
          ></dp-date-picker>
        </div>
        <div class="row">
          <small class="form-text text-muted">{{setPlaceholderData(scadenzaDaInput)}}</small>
        </div>
      </div>
      <div class="col-md-3 col-sm-4 pb-2">
        <div class="row">
          <label for="scadenzaDataA" class="title">Scadenza abilit. - A</label>
        </div>
        <div class="row">
          <svg class="bg-light icon img-calendar" (click)="openDatepicker(datePickerScadenzaA)">
            <use xlink:href="assets/img/sprite.svg#it-calendar"></use>
          </svg>
          <dp-date-picker
            mode="day"
            id="scadenzaDataA"
            theme="dp-material"
            [config]="{
              locale: 'it',
              format: 'DD/MM/YYYY',
              firstDayOfWeek: 'mo',
              showGoToCurrent: false,
              openOnClick: isCalendarOpen,
              openOnFocus: false,
              min: filtroGestioneUtentiForm.controls['dataScadenzaDa']?.value
            }"
            #scadenzaAInput = "ngModel"
            [minDate]="filtroGestioneUtentiForm.controls['dataScadenzaDa']?.value"
            date
            [(ngModel)]="filtroGestioneUtentiApplicato.dataScadenzaA"
            name="dataScadenzaA"
            #datePickerScadenzaA
            (click)="isCalendarOpen = false"
            (onSelect)="selezionaData(datePickerScadenzaA, 'dataScadenzaA')"
            (onChange)="selezionaData(datePickerScadenzaA, 'dataScadenzaA')"
          ></dp-date-picker>
        </div>
        <div class="row">
          <small class="form-text text-muted">{{setPlaceholderData(scadenzaAInput)}}</small>
        </div>
      </div>
      <div class="col-lg-2 col-md-3 col-sm-4 pb-2">
        <div class="row">
          <label for="ultimoAccessoDataDa" class="title">Ultimo accesso - Da</label>
        </div>
        <div class="row">
          <svg class="bg-light icon img-calendar" (click)="openDatepicker(datePickerUltimoAccessoDa)">
            <use xlink:href="assets/img/sprite.svg#it-calendar"></use>
          </svg>
          <dp-date-picker
            mode="day"
            id="ultimoAccessoDataDa"
            theme="dp-material"
            [config]="{
              locale: 'it',
              format: 'DD/MM/YYYY',
              firstDayOfWeek: 'mo',
              showGoToCurrent: false,
              openOnClick: isCalendarOpen,
              openOnFocus: false,
              min: minDateDDMMYY
            }"
            #ultimoAccessoDaInput = "ngModel"
            [minDate]="minDateDDMMYY"
            date
            [(ngModel)]="filtroGestioneUtentiApplicato.ultimoAccessoDa"
            name="ultimoAccessoDa"
            #datePickerUltimoAccessoDa
            (click)="isCalendarOpen = false"
            (onSelect)="selezionaData(datePickerUltimoAccessoDa, 'ultimoAccessoDa')"
            (onChange)="selezionaData(datePickerUltimoAccessoDa, 'ultimoAccessoDa')"
          ></dp-date-picker>
        </div>
        <div class="row">
          <small class="form-text text-muted">{{setPlaceholderData(ultimoAccessoDaInput)}}</small>
        </div>
      </div>
      <div class="col-md-3 col-sm-4 pb-2">
        <div class="row">
          <label for="ultimoAccessoDataA" class="title">Ultimo accesso - A</label>
        </div>
        <div class="row">
          <svg class="bg-light icon img-calendar" (click)="openDatepicker(datePickerUltimoAccessoA)">
            <use xlink:href="assets/img/sprite.svg#it-calendar"></use>
          </svg>
          <dp-date-picker
            mode="day"
            id="ultimoAccessoDataA"
            theme="dp-material"
            [config]="{
              locale: 'it',
              format: 'DD/MM/YYYY',
              firstDayOfWeek: 'mo',
              showGoToCurrent: false,
              openOnClick: isCalendarOpen,
              openOnFocus: false,
              min: filtroGestioneUtentiForm.controls['ultimoAccessoDa']?.value
            }"
            #ultimoAccessoAInput = "ngModel"
            [minDate]="filtroGestioneUtentiForm.controls['ultimoAccessoDa']?.value"
            date
            [(ngModel)]="filtroGestioneUtentiApplicato.ultimoAccessoA"
            name="ultimoAccessoA"
            #datePickerUltimoAccessoA
            (click)="isCalendarOpen = false"
            (onSelect)="selezionaData(datePickerUltimoAccessoA, 'ultimoAccessoA')"
            (onChange)="selezionaData(datePickerUltimoAccessoA, 'ultimoAccessoA')"
          ></dp-date-picker>
        </div>
        <div class="row">
          <small class="form-text text-muted">{{setPlaceholderData(ultimoAccessoAInput)}}</small>
        </div>
      </div>
    </div>

    <!-- Bottoni Pulisci e Cerca -->
    <div class="row">
      <div class="col-6">
        <button id="bottonePulisci" class="btn btn-secondary" [disabled]="disabilitaBottone(filtroGestioneUtentiForm, 'Pulisci')"
                (click)="pulisciFiltri(filtroGestioneUtentiForm)">Pulisci</button>
      </div>
      <div class="col-6 btn-find">
        <button id="bottoneCerca" class="btn" [disabled]="disabilitaBottone(filtroGestioneUtentiForm, 'Cerca')"
                (click)="cercaUtenti(filtroGestioneUtentiForm)">Cerca</button>
      </div>
    </div>
  </div>
</form>
